{{template "base/head" .}}
<div class="repository file editor edit">
	{{template "repo/header" .}}
	<div class="ui container">
		{{template "base/alert" .}}
		<form class="ui edit form" method="post">
			{{.CsrfTokenHtml}}
			<input type="hidden" name="last_commit" value="{{.last_commit}}">
			<div class="ui secondary menu">
				<div class="fitted item treepath">
					<div class="ui breadcrumb field {{if .Err_TreePath}}error{{end}}">
						<a class="section" href="{{EscapePound $.BranchLink}}">{{.Repository.Name}}</a>
						{{if $.IsNewFile}}
							{{if eq $.TreePath ".ultima.yml" }}
								<input id="file-name" value=".ultima.yml" disabled required autofocus>
							{{else}}
								{{ $n := len .TreeNames}}
								{{ $l := Subtract $n 1}}
								{{range $i, $v := .TreeNames}}
									<div class="divider"> / </div>
									{{if eq $i $l}}
										<input id="file-name" value="{{$v}}" placeholder="{{$.i18n.Tr "repo.editor.name_your_file"}}" data-editorconfig="{{$.Editorconfig}}" required autofocus>
										<span class="poping up" data-content="{{$.i18n.Tr "repo.editor.filename_help"}}" data-position="bottom center" data-variation="tiny inverted">{{svg "octicon-info" 16}}</span>
									{{else}}
										<span class="section"><a href="{{EscapePound $.BranchLink}}/{{index $.TreePaths $i | EscapePound}}">{{$v}}</a></span>
									{{end}}
								{{end}}
							{{end}}
						{{else}}
							{{ $n := len .TreeNames}}
							{{ $l := Subtract $n 1}}
							{{range $i, $v := .TreeNames}}
								<div class="divider"> / </div>
								{{if eq $i $l}}
									<input id="file-name" value="{{$v}}" placeholder="{{$.i18n.Tr "repo.editor.name_your_file"}}" data-ec-url-prefix="{{$.EditorconfigURLPrefix}}" required autofocus>
									<span class="poping up" data-content="{{$.i18n.Tr "repo.editor.filename_help"}}" data-position="bottom center" data-variation="tiny inverted">{{svg "octicon-info" 16}}</span>
								{{else}}
									<span class="section"><a href="{{EscapePound $.BranchLink}}/{{index $.TreePaths $i | EscapePound}}">{{$v}}</a></span>
								{{end}}
							{{end}}
						{{end}}
						<span>{{.i18n.Tr "repo.editor.or"}} <a href="{{EscapePound $.BranchLink}}{{if not .IsNewFile}}/{{EscapePound .TreePath}}{{end}}">{{.i18n.Tr "repo.editor.cancel_lower"}}</a></span>
						<input type="hidden" id="tree_path" name="tree_path" value="{{.TreePath}}" required>
					</div>
				</div>
			</div>
			<div class="field">
				<div class="ui top attached tabular menu" data-write="write" data-preview="preview" data-diff="diff" data-config="config">
					<a class="active item" data-tab="write">{{svg "octicon-code" 16}} {{if .IsNewFile}}{{.i18n.Tr "repo.editor.new_file"}}{{else}}{{.i18n.Tr "repo.editor.edit_file"}}{{end}}</a>
					{{if not .IsNewFile}}
					<a class="item" data-tab="preview" data-url="{{.Repository.APIURL}}/markdown" data-context="{{.RepoLink}}/src/{{.BranchNameSubURL | EscapePound}}" data-preview-file-modes="{{.PreviewableFileModes}}">{{svg "octicon-eye" 16}} {{.i18n.Tr "preview"}}</a>
					<a class="item" data-tab="diff" data-url="{{.RepoLink}}/_preview/{{.BranchName | EscapePound}}/{{.TreePath | EscapePound}}" data-context="{{.BranchLink}}">{{svg "octicon-diff" 16}} {{.i18n.Tr "repo.editor.preview_changes"}}</a>
					{{end}}
				</div>
				<div class="ui bottom attached active tab segment" data-tab="write" {{if eq .TreePath ".ultima.yml" }} id="config-editor-container" {{end}}>
					{{if eq .TreePath ".ultima.yml" }}
						<div id="ultima-config-editor" data-io="edit_area"></div>
					{{end}}
					<textarea id="edit_area" name="content" data-id="repo-{{.Repository.Name}}-{{.TreePath}}"
						data-url="{{.Repository.APIURL}}/markdown"
						data-context="{{.RepoLink}}"
						data-markdown-file-exts="{{.MarkdownFileExts}}"
						data-line-wrap-extensions="{{.LineWrapExtensions}}">
{{.FileContent}}</textarea>
					<div class="editor-loading">
						{{.i18n.Tr "loading"}}
					</div>
				</div>
				<div class="ui bottom attached tab segment markdown" data-tab="preview">
					{{.i18n.Tr "loading"}}
				</div>
				<div class="ui bottom attached tab segment diff edit-diff" data-tab="diff">
					{{.i18n.Tr "loading"}}
				</div>
			</div>
			{{template "repo/editor/commit_form" .}}
		</form>
	</div>


	<div class="ui small basic modal" id="edit-empty-content-modal">
		<div class="ui icon header">
			<i class="file icon"></i>
            {{.i18n.Tr "repo.editor.commit_empty_file_header"}}
		</div>
		<div class="center content">
			<p>{{.i18n.Tr "repo.editor.commit_empty_file_text"}}</p>
		</div>
		<div class="actions">
			<div class="ui red basic cancel inverted button">
				<i class="remove icon"></i>
                {{.i18n.Tr "repo.editor.cancel"}}
			</div>
			<div class="ui green basic ok inverted button">
				<i class="save icon"></i>
                {{.i18n.Tr "repo.editor.commit_changes"}}
			</div>
		</div>
	</div>

</div>
{{template "base/footer" .}}